<!DOCTYPE html>
<html>
<head>
  <title>StarLine Feed</title>
</head>
<body>

<h1>StarLine</h1>
<button onclick="logout()">Logout</button>
<a href="profile.html">My Profile</a>

<h3>Create Post</h3>
<textarea id="postText"></textarea>
<button onclick="post()">Post</button>

<h3>Feed</h3>
<div id="feed"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.24.0/firebase-firestore-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDaZl3MtYPutJMY1aqozvVoN8WbjNnlW20",
    authDomain: "starline-social.firebaseapp.com",
    projectId: "starline-social",
    messagingSenderId: "902689303596",
    appId: "1:902689303596:web:b77d39e05d51c5b8993589"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  auth.onAuthStateChanged(user => {
    if (!user) window.location.href = "auth.html";
  });

  function logout() {
    auth.signOut().then(() => location.href = "auth.html");
  }

  function post() {
    auth.currentUser && db.collection("posts").add({
      uid: auth.currentUser.uid,
      text: postText.value,
      time: firebase.firestore.FieldValue.serverTimestamp()
    });
    postText.value = "";
  }

  db.collection("posts").orderBy("time", "desc")
    .onSnapshot(snap => {
      feed.innerHTML = "";
      snap.forEach(doc => {
        const d = doc.data();
        const date = d.time?.toDate().toLocaleDateString();
        feed.innerHTML += `<p>${d.text}<br><small>${date}</small></p>`;
      });
    });
</script>

</body>
</html>
